<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiwanese Mahjong</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #2c1810, #1a0f0b);
            color: white; min-height: 100vh;
        }
        
        #header {
            text-align: center; padding: 20px; background: #8B4513;
            border-bottom: 5px solid #D4AF37;
        }
        h1 { font-size: 2em; margin-bottom: 10px; }
        #coins { font-size: 1.2em; font-weight: bold; color: #FFD700; }
        
        #game-container {
            max-width: 1000px; margin: 0 auto; padding: 20px;
            display: grid; grid-template-rows: 1fr auto; height: calc(100vh - 140px);
        }
        
        #table {
            background: #228B22; border: 20px solid #8B4513;
            border-radius: 20px; padding: 20px; position: relative;
            display: grid; grid-template-areas: 
                "top    top    top"
                "left   center right"
                "bottom bottom bottom";
            gap: 15px; height: 100%;
        }
        
        .player.top    { grid-area: top; }
        .player.right  { grid-area: right; }
        .player.bottom { grid-area: bottom; }
        .player.left   { grid-area: left; }
        #center        { grid-area: center; }
        
        .player {
            background: rgba(139,69,19,0.8); border: 3px solid #D4AF37;
            border-radius: 12px; padding: 15px; text-align: center;
        }
        .player.bottom { background: linear-gradient(#D4AF37, #8B4513); min-height: 180px; }
        
        .name { font-weight: bold; margin-bottom: 10px; font-size: 1.1em; }
        .bottom .name { color: #000; }
        .robot .name { color: #FF6B6B; }
        
        .hand {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 5px;
            min-height: 70px; padding: 10px;
        }
        
        .tile {
            width: 35px; height: 50px; background: linear-gradient(#F5DEB3, #D2B48C);
            border: 2px solid #8B4513; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px; cursor: pointer; box-shadow: 0 3px 10px rgba(0,0,0,0.4);
            transition: all 0.2s;
        }
        .tile.back {
            background: linear-gradient(#654321, #8B4513) !important;
            color: transparent !important;
        }
        .tile.back::after { content: 'ğŸ€„'; opacity: 0.5; }
        .tile:hover:not(.back) { transform: translateY(-2px); }
        .tile.selected { border-color: #FF0 !important; transform: scale(1.1); }
        .tile.discard { background: #DDD; transform: rotate(5deg); }
        
        #center {
            background: rgba(0,100,0,0.7); border: 3px solid #D4AF37;
            border-radius: 12px; padding: 20px; text-align: center;
        }
        #status { font-size: 1.3em; margin-bottom: 15px; }
        #discard-pile { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        
        #controls {
            display: flex; gap: 10px; justify-content: center; padding: 20px;
            background: #333; border-top: 3px solid #D4AF37;
        }
        button {
            padding: 12px 20px; border: 2px solid #D4AF37; background: #8B4513;
            color: white; border-radius: 6px; cursor: pointer; font-weight: bold;
        }
        button:hover:not(:disabled) { background: #A0522D; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        #shop {
            position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.9);
            border: 3px solid #D4AF37; border-radius: 12px; padding: 20px;
            max-width: 300px; z-index: 100;
        }
        #shop h3 { margin-bottom: 15px; color: #FFD700; }
        .shop-item { display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #444; border-radius: 6px; }
        .shop-item button { padding: 8px 15px; font-size: 14px; }
        
        @media (max-width: 768px) {
            #game-container { padding: 10px; }
            .tile { width: 30px; height: 42px; font-size: 18px; }
        }
    </style>
</head>
<body>
    <!-- SHOP -->
    <div id="shop">
        <h3>ğŸ›’ Mahjong Shop</h3>
        <div class="shop-item">
            <span>ğŸ¨ Tile Theme 1</span>
            <button onclick="buyItem(1)">50 coins</button>
        </div>
        <div class="shop-item">
            <span>â­ Golden Tiles</span>
            <button onclick="buyItem(2)">100 coins</button>
        </div>
        <div class="shop-item">
            <span>âš¡ Fast Robots</span>
            <button onclick="buyItem(3)">75 coins</button>
        </div>
        <div style="margin-top: 15px; font-size: 0.9em;">
            Earn 10 coins per round won!
        </div>
    </div>
    
    <!-- GAME -->
    <div id="header">
        <h1>ğŸ€„ Taiwanese Mahjong</h1>
        <div id="coins">ğŸ’° 100 coins</div>
    </div>
    
    <div id="game-container">
        <div id="table">
            <div class="player top robot">
                <div class="name">ğŸ¤– NORTH</div>
                <div class="hand" id="hand-north"></div>
            </div>
            
            <div class="player right robot">
                <div class="name">ğŸ¤– EAST</div>
                <div class="hand" id="hand-east"></div>
            </div>
            
            <div class="player bottom">
                <div class="name">ğŸ§‘ YOU</div>
                <div class="hand" id="hand-south"></div>
            </div>
            
            <div class="player left robot">
                <div class="name">ğŸ¤– WEST</div>
                <div class="hand" id="hand-west"></div>
            </div>
            
            <div id="center">
                <div id="status">Starting Round 1...</div>
                <div id="discard-pile"></div>
                <div style="margin-top: 10px; font-size: 0.9em;">
                    Round: <span id="round">1</span> | Tiles left: <span id="tilesLeft">144</span>
                </div>
            </div>
        </div>
    </div>
    
    <div id="controls">
        <button onclick="discardSelected()" id="discardBtn" disabled>ğŸ—‘ï¸ Discard</button>
        <button onclick="sortHand()">Sort</button>
        <button onclick="newRound()">New Round</button>
    </div>

    <script>
        const suits = {
            wan: ['ğŸ€‡','ğŸ€ˆ','ğŸ€‰','ğŸ€Š','ğŸ€‹','ğŸ€Œ','ğŸ€','ğŸ€','ğŸ€'],
            tong: ['ğŸ€™','ğŸ€š','ğŸ€›','ğŸ€œ','ğŸ€','ğŸ€','ğŸ€Ÿ','ğŸ€ ','ğŸ€¡'],
            tiao: ['ğŸ€','ğŸ€‘','ğŸ€’','ğŸ€“','ğŸ€”','ğŸ€•','ğŸ€–','ğŸ€—','ğŸ€˜']
        };
        
        let game = {
            wall: [], players: {south: [], east: [], north: [], west: []},
            discardPile: [], currentPlayer: 'south', selectedTile: null,
            round: 1, coins: 100, tilesLeft: 144
        };
        
        function createTileDeck() {
            let deck = [];
            for (let suit in suits) {
                for (let tile of suits[suit]) {
                    for (let i = 0; i < 4; i++) deck.push(tile);
                }
            }
            return shuffle(deck);
        }
        
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function deal() {
            game.wall = createTileDeck();
            game.players = {south: [], east: [], north: [], west: []};
            game.discardPile = [];
            game.tilesLeft = 144;
            game.selectedTile = null;
            
            ['south', 'east', 'north', 'west'].forEach(player => {
                for (let i = 0; i < 16; i++) {
                    game.players[player].push(game.wall.pop());
                }
            });
            game.tilesLeft -= 64;
            
            renderAll();
            updateStatus('ğŸ§‘ Your turn! Select a tile.');
            document.getElementById('discardBtn').disabled = false;
            updateCoins();
        }
        
        function renderAll() {
            renderHands();
            renderDiscardPile();
            updateUI();
        }
        
        function renderHands() {
            ['south', 'east', 'north', 'west'].forEach(player => {
                const handEl = document.getElementById(`hand-${player}`);
                handEl.innerHTML = '';
                game.players[player].forEach((tile, i) => {
                    const tileEl = document.createElement('div');
                    if (player === 'south') {
                        tileEl.className = 'tile';
                        tileEl.textContent = tile;
                        tileEl.onclick = () => selectTile(i);
                        if (game.selectedTile === i) tileEl.classList.add('selected');
                    } else {
                        tileEl.className = 'tile back';
                    }
                    handEl.appendChild(tileEl);
                });
            });
        }
        
        function renderDiscardPile() {
            const pileEl = document.getElementById('discard-pile');
            pileEl.innerHTML = '';
            game.discardPile.slice(-8).reverse().forEach(tile => {
                const tileEl = document.createElement('div');
                tileEl.className = 'tile discard';
                tileEl.textContent = tile;
                pileEl.appendChild(tileEl);
            });
        }
        
        function selectTile(index) {
            game.selectedTile = game.selectedTile === index ? null : index;
            renderHands();
        }
        
        function discardSelected() {
            if (game.selectedTile === null) return alert('Select a tile!');
            
            const tile = game.players.south.splice(game.selectedTile, 1)[0];
            game.discardPile.push(tile);
            game.selectedTile = null;
            game.tilesLeft--;
            
            renderAll();
            updateStatus('ğŸ¤– Robots playing...');
            document.getElementById('discardBtn').disabled = true;
            
            setTimeout(robotRound, 1000);
        }
        
        function robotRound() {
            const robots = ['east', 'north', 'west'];
            let i = 0;
            function nextRobot() {
                if (i >= robots.length) {
                    updateStatus('ğŸ§‘ Your turn!');
                    document.getElementById('discardBtn').disabled = false;
                    return;
                }
                const player = robots[i++];
                if (game.wall.length > 0) game.players[player].push(game.wall.pop());
                if (game.players[player].length > 0) {
                    const idx = Math.floor(Math.random() * game.players[player].length);
                    game.discardPile.push(game.players[player].splice(idx, 1)[0]);
                }
                game.tilesLeft--;
                renderAll();
                setTimeout(() => nextRobot(), 600);
            }
            nextRobot();
        }
        
        function sortHand() {
            game.players.south.sort();
            renderHands();
        }
        
        function newRound() {
            game.round = 1; // FIXED: Start at Round 1
            game.coins += 10; // Earn coins
            deal();
        }
        
        function updateStatus(msg) {
            document.getElementById('status').textContent = msg;
        }
        
        function updateUI() {
            document.getElementById('round').textContent = game.round;
            document.getElementById('tilesLeft').textContent = game.tilesLeft;
        }
        
        function updateCoins() {
            document.getElementById('coins').textContent = `ğŸ’° ${game.coins} coins`;
        }
        
        function buyItem(id) {
            const prices = [50, 100, 75];
            if (game.coins >= prices[id-1]) {
                game.coins -= prices[id-1];
                updateCoins();
                alert(`Purchased item ${id}! (Demo)`);
            } else {
                alert('Not enough coins!');
            }
        }
        
        // Initialize
        document.getElementById('discardBtn').onclick = discardSelected;
        deal();
    </script>
</body>
</html>
