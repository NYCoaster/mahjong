<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Taiwan Mahjong</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
Â  Â  --felt:#1b5e20;
Â  Â  --wood:#4e342e;
Â  Â  --ivory:#fffdf6;
Â  Â  --ivory-shadow:#cfcab8;
}

body{
Â  Â  margin:0;
Â  Â  background:#111;
Â  Â  font-family:"Segoe UI",sans-serif;
Â  Â  height:100vh;
Â  Â  display:flex;
}

#table{
Â  Â  flex:1;
Â  Â  background:var(--felt);
Â  Â  border:18px solid var(--wood);
Â  Â  border-radius:22px;
Â  Â  margin:20px;
Â  Â  position:relative;
}

/* HUD */
#hud{
Â  Â  position:absolute;
Â  Â  top:12px; left:14px;
Â  Â  background:rgba(0,0,0,.4);
Â  Â  padding:10px 14px;
Â  Â  border-radius:10px;
Â  Â  color:#fff;
Â  Â  font-size:14px;
}
#hud b{color:#ffd54f}

.zone{
Â  Â  position:absolute;
Â  Â  display:flex;
Â  Â  gap:2px;
Â  Â  justify-content:center;
Â  Â  flex-wrap:wrap;
}

#p0{bottom:15px;left:50%;transform:translateX(-50%);width:95%}
#p2{top:15px;left:50%;transform:translateX(-50%);width:95%}
#p1{right:15px;top:50%;transform:translateY(-50%);flex-direction:column}
#p3{left:15px;top:50%;transform:translateY(-50%);flex-direction:column}

.tile{
Â  Â  width:44px;
Â  Â  height:58px;
Â  Â  background:linear-gradient(145deg,var(--ivory),#f1ecd8);
Â  Â  border-radius:6px;
Â  Â  position:relative;
Â  Â  box-shadow:0 6px 10px rgba(0,0,0,.45);
Â  Â  cursor:pointer;
}
.tile::after{
Â  Â  content:'';
Â  Â  position:absolute;
Â  Â  left:2px; right:2px;
Â  Â  bottom:-7px;
Â  Â  height:7px;
Â  Â  background:linear-gradient(to bottom,var(--ivory-shadow),#b6b19f);
Â  Â  border-radius:0 0 6px 6px;
}
.tile-back{background:#0a4c8a}
.tile svg{width:100%;height:100%}

#center{
Â  Â  position:absolute;
Â  Â  inset:35% 30%;
Â  Â  display:grid;
Â  Â  grid-template-columns:repeat(6,1fr);
Â  Â  gap:2px;
}
</style>
</head>

<body>
<div id="table">
Â  Â  <div id="hud">
Â  Â  Â  Â  ðŸª™ Coins: <b id="coins">0</b><br>
Â  Â  Â  Â  ðŸ§® Tai (last win): <b id="tai">0</b>
Â  Â  </div>

Â  Â  <div id="center"></div>
Â  Â  <div id="p0" class="zone"></div>
Â  Â  <div id="p1" class="zone"></div>
Â  Â  <div id="p2" class="zone"></div>
Â  Â  <div id="p3" class="zone"></div>
</div>

<script>
/* ===============================
Â  Â SIMPLE TAIWAN MAHJONG ENGINE
Â  Â =============================== */

let deck=[],players=[[],[],[],[]],discards=[];
let coins=0,lastTai=0;
const coinsEl=document.getElementById('coins');
const taiEl=document.getElementById('tai');

function buildDeck(){
deck=[];
['dots','bamboo','chars'].forEach(t=>{
for(let i=1;i<=9;i++)for(let k=0;k<4;k++)deck.push({t,v:i});
});
['east','south','west','north','red','green','white'].forEach(v=>{
for(let k=0;k<4;k++)deck.push({t:'honor',v});
});
deck.sort(()=>Math.random()-0.5);
}

function init(){
buildDeck();
players=[[],[],[],[]];
discards=[];
for(let i=0;i<16;i++)for(let p=0;p<4;p++)players[p].push(deck.pop());
render();
setTimeout(()=>draw(0),500);
}

function draw(p){
if(!deck.length)return;
players[p].push(deck.pop());
render();
if(p!==0)setTimeout(()=>discard(p,Math.random()*players[p].length|0),700);
}

function discard(p,i){
players[p].splice(i,1);
render();
setTimeout(()=>draw((p+1)%4),500);
}

/* ===============================
Â  Â WIN + TAI CALCULATION
Â  Â =============================== */

function calculateTai(hand,isDealer=true){
let tai=1; // base win
if(isDealer) tai+=1;
tai+=Math.floor(hand.length/3)-5; // crude pung count
return Math.max(1,tai);
}

function win(){
lastTai=calculateTai(players[0],true);
coins+=10+lastTai;
coinsEl.textContent=coins;
taiEl.textContent=lastTai;
alert(`ðŸ€„ WIN!\nTai: ${lastTai}\nCoins earned: ${10+lastTai}`);
init();
}

/* ===============================
Â  Â RENDER
Â  Â =============================== */

function render(){
['p0','p1','p2','p3'].forEach((id,i)=>{
let z=document.getElementById(id);
z.innerHTML='';
players[i].forEach((t,idx)=>{
let d=document.createElement('div');
d.className='tile'+(i?' tile-back':'');
if(i===0){
d.innerHTML=`<svg viewBox="0 0 100 140"><rect x="20" y="40" width="60" height="60" rx="8" fill="#eee"/></svg>`;
d.onclick=()=>players[0].length%3===2&&discard(0,idx);
}
z.appendChild(d);
});
});
}

document.addEventListener('keydown',e=>{
if(e.key==='w') win();
});

init();
</script>
</body>
</html>
