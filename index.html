<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiwanese Mahjong (çœŸäººå°æˆ°)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Roboto', Arial, sans-serif; 
            background: linear-gradient(135deg, #2c1810 0%, #1a0f0b 100%);
            min-height: 100vh; display: flex; flex-direction: column;
        }
        
        #table {
            flex: 1; max-width: 1200px; margin: 20px auto; padding: 20px;
            background: radial-gradient(ellipse at center, #228B22 0%, #006400 70%);
            border: 30px solid #8B4513; border-radius: 25px; position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8), inset 0 0 50px rgba(0,0,0,0.3);
        }
        
        #players {
            display: grid; grid-template-areas: "east south west north"; gap: 20px;
            height: 500px; padding: 20px; position: relative;
        }
        .player.east   { grid-area: east; justify-self: end; }
        .player.south  { grid-area: south; justify-self: center; }
        .player.west   { grid-area: west; justify-self: start; }
        .player.north  { grid-area: north; justify-self: center; align-self: start; }
        
        .player { 
            background: rgba(139,69,19,0.9); border: 3px solid #D4AF37; 
            border-radius: 15px; padding: 15px; min-width: 200px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .player.east, .player.west { writing-mode: vertical-rl; }
        .player.north { transform: rotate(180deg); }
        
        .hand { display: flex; gap: 4px; justify-content: center; flex-wrap: wrap; min-height: 80px; }
        .tile {
            width: 32px; height: 48px; background: linear-gradient(145deg, #F5DEB3, #D2B48C);
            border: 2px solid #8B4513; border-radius: 4px; display: flex; align-items: center;
            justify-content: center; font-size: 20px; cursor: pointer; position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4); transition: all 0.2s;
        }
        .tile:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.6); }
        .tile.discard { background: linear-gradient(145deg, #E0E0E0, #B0B0B0); transform: rotate(5deg); }
        .tile.meld { border-color: #FFD700; box-shadow: 0 0 15px rgba(255,215,0,0.5); }
        .tile.win { animation: winPulse 0.5s infinite; border-color: #FF4500; }
        @keyframes winPulse { 0%, 100% { box-shadow: 0 0 20px #FF4500; } 50% { box-shadow: 0 0 40px #FF4500; } }
        
        #center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; }
        #discard-pile { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; max-width: 300px; }
        
        #controls { background: rgba(0,0,0,0.8); padding: 20px; text-align: center; color: white; }
        button { padding: 12px 24px; margin: 5px; border: 2px solid #D4AF37; background: #8B4513; color: white; border-radius: 8px; cursor: pointer; font-weight: bold; }
        button:hover { background: #A0522D; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        @media (max-width: 768px) {
            #players { grid-template-areas: "east" "south" "west" "north"; height: auto; }
            .player.east, .player.west { writing-mode: horizontal-tb; }
            .player.north { transform: none; }
            .tile { width: 28px; height: 42px; font-size: 18px; }
        }
    </style>
</head>
<body>
    <div id="table">
        <div id="players">
            <div class="player east" id="player-east">
                <div style="font-weight: bold; color: #FFD700;">ğŸ§‘ YOU (East)</div>
                <div class="hand" id="hand-east"></div>
                <div id="melds-east"></div>
            </div>
            <div class="player south" id="player-south">
                <div style="font-weight: bold; color: #FF6B6B;">ğŸ¤– South</div>
                <div class="hand" id="hand-south"></div>
                <div id="melds-south"></div>
            </div>
            <div class="player west" id="player-west">
                <div style="font-weight: bold; color: #4ECDC4;">ğŸ¤– West</div>
                <div class="hand" id="hand-west"></div>
                <div id="melds-west"></div>
            </div>
            <div class="player north" id="player-north">
                <div style="font-weight: bold; color: #FFE66D;">ğŸ¤– North</div>
                <div class="hand" id="hand-north"></div>
                <div id="melds-north"></div>
            </div>
        </div>
        <div id="center">
            <div id="status">Deal starting...</div>
            <div id="discard-pile"></div>
        </div>
    </div>
    
    <div id="controls">
        <button onclick="discardSelected()">ğŸ—‘ï¸ Discard Selected</button>
        <button onclick="sortHand()">ğŸ”¤ Sort Hand</button>
        <button onclick="newRound()">ğŸ”„ New Round</button>
        <div id="score">Score: 0 points</div>
    </div>

    <script>
        // Taiwanese Mahjong tiles (no flowers, 16-tile hands)
        const suits = {
            wan: ['ğŸ€‡','ğŸ€ˆ','ğŸ€‰','ğŸ€Š','ğŸ€‹','ğŸ€Œ','ğŸ€','ğŸ€','ğŸ€'],
            tong: ['ğŸ€™','ğŸ€š','ğŸ€›','ğŸ€œ','ğŸ€','ğŸ€','ğŸ€Ÿ','ğŸ€ ','ğŸ€¡'],
            tiao: ['ğŸ€','ğŸ€‘','ğŸ€’','ğŸ€“','ğŸ€”','ğŸ€•','ğŸ€–','ğŸ€—','ğŸ€˜']
        };
        
        let game = {
            wall: [], players: {east: [], south: [], west: [], north: []},
            melds: {east: [], south: [], west: [], north: []},
            discardPile: [], currentPlayer: 'east', dealer: 'east',
            selectedTile: null, playerScore: 0, round: 1
        };
        
        function createTileDeck() {
            let deck = [];
            // 4 sets of each tile (no flowers in Taiwanese)
            for (let suit in suits) {
                for (let tile of suits[suit]) {
                    for (let i = 0; i < 4; i++) deck.push(tile);
                }
            }
            return shuffle(deck);
        }
        
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function deal() {
            game.wall = createTileDeck();
            game.players = {east: [], south: [], west: [], north: []};
            game.melds = {east: [], south: [], west: [], north: []};
            game.discardPile = [];
            
            // Deal 16 tiles each (Taiwanese rules)
            ['east', 'south', 'west', 'north'].forEach((player, i) => {
                for (let j = 0; j < 16; j++) {
                    game.players[player].push(game.wall.pop());
                }
            });
            
            renderHands();
            updateStatus(`Round ${game.round} - Your turn (East Dealer)`);
            game.currentPlayer = 'east';
        }
        
        function renderHands() {
            ['east', 'south', 'west', 'north'].forEach(player => {
                renderHand(player);
                renderMelds(player);
            });
            renderDiscardPile();
        }
        
        function renderHand(player) {
            const handEl = document.getElementById(`hand-${player}`);
            handEl.innerHTML = '';
            
            game.players[player].forEach((tile, i) => {
                const tileEl = document.createElement('div');
                tileEl.className = 'tile';
                tileEl.textContent = tile;
                tileEl.onclick = () => selectTile(player, i);
                if (player === 'east' && game.selectedTile === i) {
                    tileEl.style.borderColor = '#FFD700';
                    tileEl.style.transform = 'scale(1.1)';
                }
                handEl.appendChild(tileEl);
            });
        }
        
        function renderMelds(player) {
            const meldsEl = document.getElementById(`melds-${player}`);
            meldsEl.innerHTML = '';
            game.melds[player].forEach(meld => {
                meld.forEach(tile => {
                    const tileEl = document.createElement('div');
                    tileEl.className = 'tile meld';
                    tileEl.textContent = tile;
                    meldsEl.appendChild(tileEl);
                });
            });
        }
        
        function renderDiscardPile() {
            const pileEl = document.getElementById('discard-pile');
            pileEl.innerHTML = '';
            game.discardPile.slice(-8).forEach(tile => {
                const tileEl = document.createElement('div');
                tileEl.className = 'tile discard';
                tileEl.textContent = tile;
                pileEl.appendChild(tileEl);
            });
        }
        
        function selectTile(player, index) {
            if (player !== 'east' || game.currentPlayer !== 'east') return;
            
            game.selectedTile = game.selectedTile === index ? null : index;
            renderHands();
        }
        
        function discardSelected() {
            if (game.selectedTile === null || game.currentPlayer !== 'east') return;
            
            const tile = game.players.east.splice(game.selectedTile, 1)[0];
            game.discardPile.push(tile);
            game.selectedTile = null;
            
            renderHands();
            renderDiscardPile();
            
            // Check if any robot can claim (Pung/Chow)
            if (!robotTurn()) {
                nextPlayer();
            }
        }
        
        function nextPlayer() {
            const order = ['east', 'south', 'west', 'north'];
            const currentIdx = order.indexOf(game.currentPlayer);
            game.currentPlayer = order[(currentIdx + 1) % 4];
            
            if (game.currentPlayer !== 'east') {
                setTimeout(() => robotTurn(), 800);
            } else {
                updateStatus('Your turn!');
            }
        }
        
        function robotTurn() {
            if (game.wall.length === 0) return endRound();
            
            // Draw tile
            const drawn = game.wall.pop();
            game.players[game.currentPlayer].push(drawn);
            
            // Simple robot AI: look for Pung or discard randomly
            const hand = game.players[game.currentPlayer];
            let discardIdx = hand.length - 1; // Default to drawn tile
            
            // Check for Pung
            for (let i = 0; i < hand.length; i++) {
                let count = hand.filter(t => t === hand[i]).length;
                if (count >= 3) {
                    discardIdx = i;
                    break;
                }
            }
            
            // Discard
            const tile = hand.splice(discardIdx, 1)[0];
            game.discardPile.push(tile);
            
            renderHands();
            renderDiscardPile();
            updateStatus(`${game.currentPlayer.toUpperCase()} discards`);
            
            if (!checkPlayerWin(tile)) {
                setTimeout(() => nextPlayer(), 1000);
            }
        }
        
        function checkPlayerWin(tile) {
            // Simple win check - 4 melds + pair
            ['south', 'west', 'north'].forEach(player => {
                if (hasMahjong(game.players[player])) {
                    updateStatus(`${player.toUpperCase()} wins!`);
                    endRound();
                    return true;
                }
            });
            return false;
        }
        
        function hasMahjong(hand) {
            // Simplified Mahjong check (4 melds + pair)
            if (hand.length !== 14) return false;
            // Basic pattern matching (in real game, much more complex)
            return Math.random() < 0.1; // 10% chance for demo
        }
        
        function sortHand() {
            if (game.currentPlayer !== 'east') return;
            game.players.east.sort();
            renderHands();
        }
        
        function updateStatus(msg) {
            document.getElementById('status').textContent = msg;
        }
        
        function newRound() {
            game.round++;
            deal();
        }
        
        function endRound() {
            updateStatus('Round ended! New round starting...');
            setTimeout(newRound, 2000);
        }
        
        // Initialize game
        document.getElementById('robotToggle')?.addEventListener('click', toggleRobot);
        deal();
    </script>
</body>
</html>
