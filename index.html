<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiwanese Mahjong Solitaire vs ğŸ¤– Robot</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Roboto', Arial, sans-serif; 
            min-height: 100vh; overflow-x: hidden; 
            background: linear-gradient(135deg, #2c1810 0%, #1a0f0b 50%, #3d2b1f 100%);
            position: relative;
        }
        
        /* Mahjong Table Background */
        #table-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: 
                radial-gradient(ellipse at center, rgba(139,69,19,0.3) 0%, transparent 70%),
                repeating-linear-gradient(90deg, transparent, transparent 49px, rgba(0,0,0,0.1) 50px, rgba(0,0,0,0.1) 51px, transparent 52px);
        }
        #table-felt {
            position: absolute; top: 50%; left: 50%; width: 80%; height: 60%; 
            transform: translate(-50%, -50%); background: radial-gradient(ellipse, #228B22 0%, #006400 70%);
            border: 40px solid #8B4513; border-radius: 20px; box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
        }
        
        #game-container { display: flex; flex-direction: column; align-items: center; padding: 20px; min-height: 100vh; position: relative; z-index: 1; }
        
        #ui { text-align: center; color: #fff; margin: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); background: rgba(0,0,0,0.7); padding: 25px; border-radius: 15px; border: 3px solid #D4AF37; }
        h1 { font-size: 2.5em; margin-bottom: 10px; background: linear-gradient(45deg, #D4AF37, #FFD700); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        #status { font-size: 18px; margin: 10px 0; }
        button { padding: 12px 24px; font-size: 16px; margin: 5px; border: 2px solid #D4AF37; border-radius: 8px; background: linear-gradient(145deg, #8B4513, #A0522D); color: white; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.5); transition: all 0.3s; }
        button:hover { background: linear-gradient(145deg, #A0522D, #D2691E); transform: translateY(-2px); }
        
        #game { 
            display: grid; grid-template-columns: repeat(20, 1fr); gap: 4px; 
            max-width: 1000px; margin: 20px auto; padding: 30px; 
            background: linear-gradient(145deg, #654321, #8B4513); border: 8px solid #D4AF37;
            border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.7), inset 0 0 30px rgba(255,255,255,0.1);
            position: relative;
        }
        #game::before {
            content: ''; position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 60px; background: radial-gradient(circle, #FFD700, #D4AF37); border-radius: 50%;
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        
        .tile { 
            aspect-ratio: 1; 
            background: linear-gradient(145deg, #F5DEB3 0%, #D2B48C 50%, #DEB887 100%); 
            border: 4px solid #8B4513; border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 28px; font-weight: bold; cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative; box-shadow: 
                0 8px 20px rgba(0,0,0,0.4), 
                inset 0 2px 4px rgba(255,255,255,0.3),
                inset 0 -2px 4px rgba(0,0,0,0.2);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            min-height: 50px;
        }
        .tile::before { 
            content: attr(data-pips); position: absolute; top: 4px; font-size: 14px; 
            color: #8B4513; font-weight: normal; text-shadow: none;
        }
        .tile:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0,0,0,0.6); }
        .tile.robot-selected { 
            border-color: #FF4500 !important; 
            box-shadow: 0 0 40px rgba(255,69,0,0.9), inset 0 0 20px rgba(255,69,0,0.3) !important; 
            animation: robot-glow 0.8s infinite alternate; 
        }
        @keyframes robot-glow { 0% { box-shadow: 0 0 30px rgba(255,69,0,0.7); } 100% { box-shadow: 0 0 50px rgba(255,69,0,1); } }
        .tile.matched { visibility: hidden; animation: explode 0.6s; }
        .tile.open { border-color: #32CD32; transform: scale(1.1) translateY(-10px); box-shadow: 0 15px 40px rgba(50,205,50,0.7); }
        .tile.disabled { opacity: 0.3; cursor: not-allowed; }
        .tile.empty { background: rgba(139,69,19,0.3); border-color: rgba(139,69,19,0.5); cursor: default; opacity: 0.1; }
        @keyframes explode { to { transform: scale(0) rotate(360deg); opacity: 0; } }
        
        @media (max-width: 768px) { #game { grid-template-columns: repeat(18, 1fr); gap: 3px; padding: 20px; } .tile { font-size: 24px; min-height: 40px; } }
        @media (max-width: 480px) { #game { grid-template-columns: repeat(16, 1fr); } .tile { font-size: 20px; } }
    </style>
</head>
<body>
    <div id="table-bg">
        <div id="table-felt"></div>
    </div>
    
    <div id="game-container">
        <div id="ui">
            <h1>ğŸ€„ Taiwanese Mahjong vs ğŸ¤– Robot</h1>
            <div id="status">Loading tiles...</div>
            <div id="moves">Moves: <span id="playerMoves">0</span> | Robot: <span id="robotMoves">0</span></div>
            <button id="robotToggle">ğŸš« Disable Robot</button>
            <button onclick="newGame()">ğŸ”„ New Game</button>
            <button onclick="hint()">ğŸ’¡ Hint</button>
        </div>
        <div id="game"></div>
    </div>

    <script>
        // Taiwanese Mahjong tiles (1-9 Wan, Tong, Tiao)
        const taiwaneseTiles = ['ğŸ€‡','ğŸ€ˆ','ğŸ€‰','ğŸ€Š','ğŸ€‹','ğŸ€Œ','ğŸ€','ğŸ€','ğŸ€','ğŸ€™','ğŸ€š','ğŸ€›','ğŸ€œ','ğŸ€','ğŸ€','ğŸ€Ÿ','ğŸ€ ','ğŸ€¡','ğŸ€','ğŸ€‘','ğŸ€’','ğŸ€“','ğŸ€”','ğŸ€•','ğŸ€–','ğŸ€—','ğŸ€˜'];
        let board = [], openTiles = [], playerMoves = 0, robotMoves = 0, robotEnabled = true, robotTurn = false;
        
        function initBoard() {
            document.getElementById('status').textContent = 'Generating pyramid...';
            
            // Classic Taiwanese pyramid (144 tiles total)
            const pyramidRows = 8;
            const cols = 20;
            let tileCount = 0;
            
            // Create exactly 144 tiles
            let tileDeck = [];
            for (let i = 0; i < 4; i++) { // 4 complete sets
                tileDeck.push(...taiwaneseTiles);
            }
            tileDeck = shuffle(tileDeck.slice(0, 144)); // Exactly 144 tiles
            
            // Build pyramid layout
            board = [];
            for (let row = 0; row < pyramidRows; row++) {
                let rowTiles = [];
                let tilesInRow = Math.min(8 + row * 2, cols);
                let startCol = Math.floor((cols - tilesInRow) / 2);
                
                for (let col = 0; col < cols; col++) {
                    if (col >= startCol && col < startCol + tilesInRow && tileCount < 144) {
                        rowTiles.push(tileDeck[tileCount++]);
                    } else {
                        rowTiles.push(null);
                    }
                }
                board.push(rowTiles);
            }
            
            document.getElementById('status').textContent = 'Ready! Your turn.';
            renderBoard();
        }
        
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function renderBoard() {
            const gameEl = document.getElementById('game');
            gameEl.innerHTML = '';
            
            board.forEach((row, y) => {
                row.forEach((tile, x) => {
                    const tileEl = document.createElement('div');
                    if (tile) {
                        tileEl.className = 'tile';
                        tileEl.textContent = tile;
                        tileEl.dataset.pips = getPips(tile);
                        tileEl.onclick = () => selectTile(x, y, false);
                    } else {
                        tileEl.className = 'tile empty';
                    }
                    gameEl.appendChild(tileEl);
                });
            });
            updateDisabled();
        }
        
        function getPips(tile) {
            const pips = {
                'ğŸ€‡':'1','ğŸ€ˆ':'2','ğŸ€‰':'3','ğŸ€Š':'4','ğŸ€‹':'5','ğŸ€Œ':'6','ğŸ€':'7','ğŸ€':'8','ğŸ€':'9', // Wan
                'ğŸ€™':'1','ğŸ€š':'2','ğŸ€›':'3','ğŸ€œ':'4','ğŸ€':'5','ğŸ€':'6','ğŸ€Ÿ':'7','ğŸ€ ':'8','ğŸ€¡':'9', // Tong
                'ğŸ€':'1','ğŸ€‘':'2','ğŸ€’':'3','ğŸ€“':'4','ğŸ€”':'5','ğŸ€•':'6','ğŸ€–':'7','ğŸ€—':'8','ğŸ€˜':'9'  // Tiao
            };
            return pips[tile] || '';
        }
        
        function selectTile(x, y, isRobot = false) {
            if (!board[y] || !board[y][x] || openTiles.some(([ox, oy]) => ox === x && oy === y) || !isFree(x, y)) return;
            
            const tile = board[y][x];
            const tileIndex = y * 20 + x;
            const tileEl = document.querySelectorAll('.tile')[tileIndex];
            
            openTiles.push([x, y]);
            tileEl.classList.add('open');
            
            if (isRobot) {
                tileEl.classList.add('robot-selected');
                robotMoves++;
            } else {
                playerMoves++;
            }
            
            updateUI();
            
            if (openTiles.length === 2) {
                const [[x1, y1]] = openTiles;
                if (board[y1][x1] !== tile) {
                    setTimeout(() => closeMismatch(), 800);
                } else {
                    setTimeout(() => matchSuccess(x, y, x1, y1), 800);
                }
            }
            updateDisabled();
        }
        
        function robotMove() {
            if (!robotEnabled || openTiles.length > 0) return;
            
            for (let y1 = 0; y1 < board.length; y1++) {
                for (let x1 = 0; x1 < 20; x1++) {
                    if (board[y1][x1] && isFree(x1, y1)) {
                        for (let y2 = 0; y2 < board.length; y2++) {
                            for (let x2 = 0; x2 < 20; x2++) {
                                if ((x2 !== x1 || y2 !== y1) && board[y2][x2] === board[y1][x1] && isFree(x2, y2)) {
                                    robotTurn = true;
                                    selectTile(x1, y1, true);
                                    setTimeout(() => {
                                        if (openTiles.length === 1) {
                                            selectTile(x2, y2, true);
                                        }
                                    }, 400);
                                    return;
                                }
                            }
                        }
                    }
                }
            }
        }
        
        function closeMismatch() {
            openTiles.forEach(([x, y]) => {
                const tileEl = document.querySelectorAll('.tile')[y * 20 + x];
                tileEl.classList.remove('open', 'robot-selected');
            });
            openTiles = [];
            robotTurn = false;
            updateDisabled();
            if (robotEnabled) setTimeout(robotMove, 800);
        }
        
        function matchSuccess(x2, y2, x1, y1) {
            board[y1][x1] = null;
            board[y2][x2] = null;
            document.querySelectorAll('.tile')[y1 * 20 + x1].classList.add('matched');
            document.querySelectorAll('.tile')[y2 * 20 + x2].classList.add('matched');
            openTiles = [];
            robotTurn = false;
            checkWin();
            updateDisabled();
            if (robotEnabled) setTimeout(robotMove, 1200);
        }
        
        function isFree(x, y) {
            if (!board[y] || !board[y][x]) return false;
            const leftFree = x === 0 || !board[y][x-1];
            const rightFree = x === 19 || !board[y][x+1];
            const topFree = y === 0 || !board[y-1][x];
            return (leftFree || rightFree) && topFree;
        }
        
        function updateDisabled() {
            document.querySelectorAll('.tile').forEach((el, i) => {
                const x = i % 20;
                const y = Math.floor(i / 20);
                if (board[y]?.[x] && !el.classList.contains('open') && !el.classList.contains('matched')) {
                    el.classList.toggle('disabled', !isFree(x, y));
                }
            });
        }
        
        function updateUI() {
            document.getElementById('playerMoves').textContent = playerMoves;
            document.getElementById('robotMoves').textContent = robotMoves;
            document.getElementById('status').textContent = robotTurn ? 'ğŸ¤– Robot thinking...' : 'ğŸ‘¤ Your turn';
        }
        
        function checkWin() {
            const tilesLeft = board.flat().filter(t => t).length;
            if (tilesLeft === 0) {
                setTimeout(() => {
                    alert(`ğŸ‰ Victory!\nYou: ${playerMoves} moves | Robot: ${robotMoves} moves`);
                }, 500);
            }
        }
        
        function toggleRobot() {
            robotEnabled = !robotEnabled;
            const btn = document.getElementById('robotToggle');
            btn.textContent = robotEnabled ? 'ğŸš« Disable Robot' : 'â–¶ï¸ Enable Robot';
        }
        
        function newGame() {
            playerMoves = robotMoves = 0;
            openTiles = [];
            robotTurn = false;
            robotEnabled = true;
            document.getElementById('robotToggle').textContent = 'ğŸš« Disable Robot';
            initBoard();
        }
        
        function hint() {
            for (let y1 = 0; y1 < board.length; y1++) {
                for (let x1 = 0; x1 < 20; x1++) {
                    if (board[y1][x1] && isFree(x1, y1)) {
                        for (let y2 = 0; y2 < board.length; y2++) {
                            for (let x2 = 0; x2 < 20; x2++) {
                                if ((x2 !== x1 || y2 !== y1) && board[y2][x2] === board[y1][x1] && isFree(x2, y2)) {
                                    document.querySelectorAll('.tile')[y1 * 20 + x1].style.boxShadow = '0 0 30px #FFD700';
                                    setTimeout(() => {
                                        document.querySelectorAll('.tile')[y1 * 20 + x1].style.boxShadow = '';
                                    }, 2000);
                                    return;
                                }
                            }
                        }
                    }
                }
            }
            alert('No available matches!');
        }
        
        // Start the game
        document.getElementById('robotToggle').onclick = toggleRobot;
        initBoard();
        setTimeout(() => { if (robotEnabled) robotMove(); }, 1500);
    </script>
</body>
</html>
