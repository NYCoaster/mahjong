<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£éº»å°‡ Solitaire vs ğŸ¤– Robot</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Noto Sans TC', Arial, sans-serif; 
            min-height: 100vh; 
            overflow-x: hidden;
            position: relative;
        }
        
        /* Animated Taiwanese Temple Background */
        #background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #ff6b6b 100%);
            z-index: -2;
        }
        #bg-pattern {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120,219,226,0.15) 0%, transparent 50%);
            animation: drift 20s ease-in-out infinite;
        }
        @keyframes drift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(1deg); }
            66% { transform: translate(-20px, 20px) rotate(-1deg); }
        }
        #bg-lanterns {
            position: absolute; top: 10%; right: 10%; width: 60px; height: 60px;
            background: radial-gradient(circle, #ff6b6b, #ff8e8e); border-radius: 50% 50% 50% 0;
            animation: float 3s ease-in-out infinite; box-shadow: 0 0 20px rgba(255,107,107,0.5);
        }
        #bg-lanterns::after {
            content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            width: 2px; height: 30px; background: #ffd700;
        }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(2deg); } }
        
        #game-container { 
            display: flex; flex-direction: column; align-items: center; 
            padding: 20px; min-height: 100vh; position: relative; z-index: 1;
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
        }
        
        #ui { 
            text-align: center; color: #fff; margin: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.2); padding: 20px; border-radius: 20px; backdrop-filter: blur(10px);
        }
        h1 { 
            font-size: 2.5em; margin-bottom: 10px; 
            background: linear-gradient(45deg, #fff, #ffd700); -webkit-background-clip: text; 
            background-clip: text; -webkit-text-fill-color: transparent;
        }
        #status { font-size: 18px; margin: 10px 0; }
        button { 
            padding: 12px 24px; font-size: 16px; margin: 5px; border: none; border-radius: 12px; 
            background: linear-gradient(145deg, #28a745, #20c997); color: white; cursor: pointer; 
            font-weight: bold; box-shadow: 0 6px 20px rgba(40,167,69,0.4); transition: all 0.3s;
            border: 2px solid rgba(255,255,255,0.3);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(40,167,69,0.6); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .robot-indicator { color: #ff6b6b; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        #game { 
            display: grid; grid-template-columns: repeat(20, 1fr); gap: 3px; 
            max-width: 900px; margin: 20px auto; position: relative; padding: 20px;
            background: rgba(255,255,255,0.05);
        }
        .tile { 
            aspect-ratio: 1; background: linear-gradient(145deg, #f8f9fa, #e9ecef); 
            border: 3px solid #495057; border-radius: 8px; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; font-size: 20px; font-weight: bold; 
            cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; 
            box-shadow: 0 6px 20px rgba(0,0,0,0.2); text-shadow: 1px 1px 1px rgba(255,255,255,0.8);
        }
        .tile::before { content: attr(data-pips); position: absolute; top: 3px; font-size: 12px; color: #666; }
        .tile.robot-selected { border-color: #ff6b6b !important; box-shadow: 0 0 30px rgba(255,107,107,0.8); animation: robot-glow 0.6s infinite alternate; }
        @keyframes robot-glow { 0% { box-shadow: 0 0 20px rgba(255,107,107,0.6); } 100% { box-shadow: 0 0 40px rgba(255,107,107,1); } }
        .tile.matched { visibility: hidden; animation: explode 0.6s; }
        .tile.open { border-color: #28a745; transform: scale(1.08) translateY(-8px); box-shadow: 0 12px 40px rgba(40,167,69,0.6); }
        .tile.disabled { opacity: 0.4; cursor: not-allowed; }
        @keyframes explode { to { transform: scale(0) rotate(180deg); opacity: 0; } }
        
        @media (max-width: 768px) { 
            #game { grid-template-columns: repeat(18, 1fr); gap: 2px; } 
            .tile { font-size: 18px; } .tile::before { font-size: 10px; }
        }
        @media (max-width: 480px) { #game { grid-template-columns: repeat(16, 1fr); } }
    </style>
</head>
<body>
    <div id="background">
        <div id="bg-pattern"></div>
        <div id="bg-lanterns"></div>
    </div>
    
    <div id="game-container">
        <div id="ui">
            <h1>ğŸ€„ å°ç£éº»å°‡ vs ğŸ¤– æ©Ÿå™¨äºº</h1>
            <div id="status">ç­‰å¾…ç©å®¶ç§»å‹•...</div>
            <div id="moves">æ­¥æ•¸: <span id="playerMoves">0</span> | æ©Ÿå™¨äºº: <span id="robotMoves">0</span></div>
            <button onclick="toggleRobot()">ğŸš« åœç”¨æ©Ÿå™¨äºº</button>
            <button onclick="newGame()">ğŸ”„ æ–°éŠæˆ²</button>
            <button onclick="hint()">ğŸ’¡ æç¤º</button>
        </div>
        <div id="game"></div>
    </div>

    <script>
        const taiwaneseTiles = ['ğŸ€‡','ğŸ€ˆ','ğŸ€‰','ğŸ€Š','ğŸ€‹','ğŸ€Œ','ğŸ€','ğŸ€','ğŸ€','ğŸ€™','ğŸ€š','ğŸ€›','ğŸ€œ','ğŸ€','ğŸ€','ğŸ€Ÿ','ğŸ€ ','ğŸ€¡','ğŸ€','ğŸ€‘','ğŸ€’','ğŸ€“','ğŸ€”','ğŸ€•','ğŸ€–','ğŸ€—','ğŸ€˜'];
        let board = [], openTiles = [], playerMoves = 0, robotMoves = 0, robotEnabled = true, robotTurn = false;
        
        function initBoard() {
            const pyramidLayout = [
                [0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],
                [0,0,0,1,2,2,2,2,2,2,2,2,2,1,1,0,0,0,0,0],
                [0,0,1,2,3,3,3,3,3,3,3,3,2,1,1,1,0,0,0,0],
                [0,1,2,3,4,4,4,4,4,4,4,4,3,2,1,1,1,0,0,0],
                [1,2,3,4,5,5,5,5,5,5,5,5,4,3,2,1,1,0,0,0],
                [2,3,4,5,6,6,6,6,6,6,6,6,5,4,3,2,1,1,0,0],
                [3,4,5,6,7,7,7,7,7,7,7,7,6,5,4,3,2,1,1,0],
                [4,5,6,7,8,8,8,8,8,8,8,8,7,6,5,4,3,2,1,1]
            ];
            let tileDeck = [...taiwaneseTiles, ...taiwaneseTiles, ...taiwaneseTiles, ...taiwaneseTiles];
            shuffle(tileDeck);
            let flatBoard = [];
            pyramidLayout.forEach(row => row.forEach(hasTile => flatBoard.push(hasTile ? tileDeck.pop() : 0)));
            board = chunkArray(flatBoard, 20);
            renderBoard();
        }
        
        function chunkArray(arr, size) {
            return arr.reduce((rows, item, idx) => (idx % size === 0 ? rows.push([item]) : rows[rows.length-1].push(item)) && rows, []);
        }
        
        function shuffle(array) { for (let i = array.length - 1; i > 0; i--) [array[i], array[Math.floor(Math.random() * (i + 1))]] = [array[Math.floor(Math.random() * (i + 1))], array[i]]; return array; }
        
        function renderBoard() {
            const gameEl = document.getElementById('game'); gameEl.innerHTML = '';
            board.forEach((row, y) => row.forEach((tile, x) => {
                const tileEl = document.createElement('div');
                if (tile) {
                    tileEl.className = 'tile'; tileEl.textContent = tile; tileEl.dataset.pips = getPips(tile);
                    tileEl.onclick = () => selectTile(x, y, false);
                } else {
                    tileEl.style.visibility = 'hidden'; tileEl.style.height = '0';
                }
                gameEl.appendChild(tileEl);
            }));
            updateDisabled();
        }
        
        function getPips(tile) {
            const pips = {'ğŸ€‡':'1','ğŸ€ˆ':'2','ğŸ€‰':'3','ğŸ€Š':'4','ğŸ€‹':'5','ğŸ€Œ':'6','ğŸ€':'7','ğŸ€':'8','ğŸ€':'9','ğŸ€™':'1','ğŸ€š':'2','ğŸ€›':'3','ğŸ€œ':'4','ğŸ€':'5','ğŸ€':'6','ğŸ€Ÿ':'7','ğŸ€ ':'8','ğŸ€¡':'9'};
            return pips[tile] || '';
        }
        
        function selectTile(x, y, isRobot = false) {
            if (!board[y]?.[x] || openTiles.some(([ox, oy]) => ox === x && oy === y) || !isFree(x, y)) return;
            
            const tile = board[y][x], tileEl = document.querySelectorAll('.tile')[y * 20 + x];
            openTiles.push([x, y]); tileEl.classList.add('open');
            
            if (isRobot) tileEl.classList.add('robot-selected');
            
            if (openTiles.length === 2) {
                const [[x1, y1]] = openTiles;
                (isRobot ? robotMoves : playerMoves)++;
                updateUI();
                
                if (board[y1][x1] !== tile) {
                    setTimeout(() => closeMismatch(), 1000);
                } else {
                    setTimeout(() => matchSuccess(x, y, x1, y1), 1000);
                }
            }
            updateDisabled();
        }
        
        function robotMove() {
            if (!robotEnabled || openTiles.length > 0 || board.flat().filter(t => t).length < 2) return;
            
            // Smart robot AI: find best match
            for (let y1 = 0; y1 < board.length; y1++) for (let x1 = 0; x1 < 20; x1++) {
                if (board[y1]?.[x1] && isFree(x1, y1)) {
                    for (let y2 = 0; y2 < board.length; y2++) for (let x2 = 0; x2 < 20; x2++) {
                        if ((x2 !== x1 || y2 !== y1) && board[y2]?.[x2] === board[y1][x1] && isFree(x2, y2)) {
                            robotTurn = true;
                            selectTile(x1, y1, true);
                            setTimeout(() => {
                                if (openTiles.length === 1) selectTile(x2, y2, true);
                            }, 500);
                            return;
                        }
                    }
                }
            }
        }
        
        function closeMismatch() {
            openTiles.forEach(([x, y]) => document.querySelectorAll('.tile')[y * 20 + x].classList.remove('open', 'robot-selected'));
            openTiles = []; robotTurn = false; updateDisabled();
            if (robotEnabled) setTimeout(robotMove, 1000);
        }
        
        function matchSuccess(x2, y2, x1, y1) {
            [[x1,y1],[x2,y2]].forEach(([x,y]) => {
                board[y][x] = 0;
                document.querySelectorAll('.tile')[y * 20 + x].classList.add('matched');
            });
            openTiles = []; robotTurn = false; checkWin(); updateDisabled();
            if (robotEnabled && !checkWin()) setTimeout(robotMove, 1500);
        }
        
        function isFree(x, y) {
            const leftFree = x === 0 || board[y][x-1] === 0;
            const rightFree = x === 19 || board[y][x+1] === 0;
            const topFree = y === 0 || board[y-1][x] === 0;
            return (leftFree || rightFree) && topFree;
        }
        
        function updateDisabled() {
            document.querySelectorAll('.tile').forEach((el, i) => {
                const x = i % 20, y = Math.floor(i / 20);
                if (board[y]?.[x] && !el.classList.contains('open') && !el.classList.contains('matched')) {
                    el.classList.toggle('disabled', !isFree(x, y) || (robotTurn && !robotEnabled));
                }
            });
        }
        
        function updateUI() {
            document.getElementById('playerMoves').textContent = playerMoves;
            document.getElementById('robotMoves').textContent = robotMoves;
            document.getElementById('status').textContent = robotTurn ? 'ğŸ¤– æ©Ÿå™¨äººæ€è€ƒä¸­...' : 'ğŸ‘¤ ç©å®¶å›åˆ';
        }
        
        function checkWin() {
            if (board.flat().every(t => t === 0)) {
                setTimeout(() => alert(`ğŸ‰ é€šé—œæˆåŠŸ!\nç©å®¶: ${playerMoves}æ­¥ | æ©Ÿå™¨äºº: ${robotMoves}æ­¥`), 500);
            }
        }
        
        function toggleRobot() {
            robotEnabled = !robotEnabled;
            document.querySelector('button:nth-child(1)').textContent = robotEnabled ? 'ğŸš« åœç”¨æ©Ÿå™¨äºº' : 'â–¶ï¸ å•Ÿç”¨æ©Ÿå™¨äºº';
            if (robotEnabled) setTimeout(robotMove, 1000);
        }
        
        function newGame() {
            playerMoves = robotMoves = 0; openTiles = []; robotTurn = false;
            initBoard(); updateUI();
        }
        
        function hint() {
            // Player hint (robot doesn't need hints!)
            for (let y1 = 0; y1 < board.length; y1++) for (let x1 = 0; x1 < 20; x1++) {
                if (board[y1]?.[x1] && isFree(x1, y1)) for (let y2 = 0; y2 < board.length; y2++) for (let x2 = 0; x2 < 20; x2++) {
                    if ((x2 !== x1 || y2 !== y1) && board[y2]?.[x2] === board[y1][x1] && isFree(x2, y2)) {
                        document.querySelectorAll('.tile')[y1*20 + x1].style.boxShadow = '0 0 30px #ffd700';
                        setTimeout(() => document.querySelectorAll('.tile')[y1*20 + x1].style.boxShadow = '', 2000);
                        return;
                    }
                }
            }
            alert('æš«ç„¡å¯é…å°çš„ç‰Œï¼');
        }
        
        // Auto-start robot after 2 seconds
        initBoard(); updateUI(); setTimeout(() => { if (robotEnabled) robotMove(); }, 2000);
    </script>
</body>
</html>
