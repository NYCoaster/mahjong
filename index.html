<!DOCTYPE html>
<html>
<head>
    <title>Taiwanese Mahjong with Robots</title>
    <style>
        body { font-family: Arial; background: #f0f8ff; text-align: center; }
        .hand { display: inline-block; margin: 10px; background: white; border: 2px solid #ccc; padding: 10px; }
        .tile { display: inline-block; width: 30px; height: 40px; margin: 2px; border: 1px solid #333; background: #ffe4b5; line-height: 40px; font-size: 12px; cursor: pointer; }
        .tile:hover { background: #ffdab9; }
        .discard { background: #ff6b6b; }
        .meld { background: #90ee90; border: 2px solid green; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px; }
        #log { height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; text-align: left; }
    </style>
</head>
<body>
    <h1>ðŸ€„ Taiwanese Mahjong vs Robots</h1>
    <p>16-tile hands, first to 5+ tai wins. Click tiles to discard.</p>
    
    <div id="hands"></div>
    <button onclick="newGame()">New Game</button>
    <button onclick="autoPlay()">Auto (1 turn)</button>
    <div id="log"></div>

    <script>
        // Taiwanese tiles: suits c/b/ch 1-9x4, honors e/s/w/n/rd/gd/wd x4, bonus f1-4/s1-4
        const SUITS = ['c','b','ch'], HONORS = ['e','s','w','n','rd','gd','wd'], BONUS = ['f1','f2','f3','f4','s1','s2','s3','s4'];
        
        let game = { deck: [], players: [], wall: [], currentPlayer: 0, selectedTile: null, gameOver: false };
        
        function createTile() {
            let deck = [];
            for(let suit of SUITS) for(let n=1; n<=9; n++) for(let i=0; i<4; i++) deck.push(`${n}${suit}`);
            for(let h of HONORS) for(let i=0; i<4; i++) deck.push(h);
            deck = deck.concat(BONUS);
            return deck;
        }
        
        function Player(name, isRobot) {
            this.name = name; this.isRobot = isRobot; this.hand = []; this.melds = []; this.bonus = []; this.discards = [];
        }
        
        function newGame() {
            game.deck = createTile(); game.shuffle(game.deck); game.wall = game.deck.slice(0,136);
            game.players = [new Player('You'), new Player('Robot1',true), new Player('Robot2',true), new Player('Robot3',true)];
            game.currentPlayer = 0; game.selectedTile = null; game.gameOver = false;
            
            game.players.forEach(p => {
                p.hand = []; p.melds = []; p.bonus = []; p.discards = [];
                for(let i=0; i<16; i++) {
                    let tile = game.draw();
                    p.hand.push(tile);
                    if(BONUS.includes(tile)) { p.bonus.push(tile); p.hand.pop(); p.hand.push(game.draw()); }
                }
                game.sortHand(p);
            });
            updateDisplay();
            log(`${game.players[0].name}'s turn! Click a tile to discard.`);
        }
        
        game.shuffle = arr => { for(let i=arr.length; i; i--) [arr[i-1], arr[i-1]] = [arr[rand()%i], arr[i-1]]; };
        game.rand = Math.random;
        game.draw = () => game.wall.shift();
        game.sortHand = p => p.hand.sort((a,b) => a==b?0 : SUITS.includes(a.slice(-1)) !== SUITS.includes(b.slice(-1)) ? SUITS.includes(a.slice(-1))?-1:1 : a>b?-1:1);
        
        function updateDisplay() {
            let html = '';
            game.players.forEach((p,i) => {
                let opp = i!==0 ? 'display:none;' : ''; // Hide robot hands
                html += `<div class="hand ${i===game.currentPlayer?'active':''}" style="${opp}">
                    <h3>${p.name} (${p.hand.length} tiles, ${p.bonus.length} bonus)</h3>
                    ${p.hand.map(t => `<div class="tile ${game.selectedTile===t?'selected':''}" onclick="selectTile('${t}',${i})">${tileEmoji(t)}</div>`).join('')}
                    ${p.melds.map(m => `<div class="meld">${m.map(tileEmoji).join('')}</div>`).join('')}
                </div>`;
            });
            document.getElementById('hands').innerHTML = html;
        }
        
        function tileEmoji(t) {
            const EMOJI = {'1c':'ðŸ€™','2c':'ðŸ€š','3c':'ðŸ€›','4c':'ðŸ€œ','5c':'ðŸ€','6c':'ðŸ€ž','7c':'ðŸ€Ÿ','8c':'ðŸ€ ','9c':'ðŸ€¡',
                          '1b':'ðŸ€','2b':'ðŸ€‘','3b':'ðŸ€’','4b':'ðŸ€“','5b':'ðŸ€”','6b':'ðŸ€•','7b':'ðŸ€–','8b':'ðŸ€—','9b':'ðŸ€˜',
                          '1ch':'ðŸ€‡','2ch':'ðŸ€ˆ','3ch':'ðŸ€‰','4ch':'ðŸ€Š','5ch':'ðŸ€‹','6ch':'ðŸ€Œ','7ch':'ðŸ€','8ch':'ðŸ€Ž','9ch':'ðŸ€',
                          'e':'ðŸ€€','s':'ðŸ€','w':'ðŸ€‚','n':'ðŸ€ƒ','rd':'ðŸ€…','gd':'ðŸ€†','wd':'ðŸ€„','f1':'ðŸ€¢','f2':'ðŸ€£'};
            return EMOJI[t] || t;
        }
        
        function selectTile(tile, playerIdx) {
            if(game.gameOver || playerIdx!==0) return;
            if(game.selectedTile === tile) {
                game.players[0].discards.push(tile);
                game.players[0].hand = game.players[0].hand.filter(t => t!==tile);
                log(`You discard ${tileEmoji(tile)}`);
                nextTurn();
                game.selectedTile = null;
            } else {
                game.selectedTile = tile;
                updateDisplay();
            }
        }
        
        function robotTurn() {
            let p = game.players[game.currentPlayer];
            // Simple AI: discard singleton honor or random
            let counts = {}, hand = p.hand.slice();
            hand.forEach(t => counts[t] = (counts[t]||0)+1);
            let discard = null;
            for(let t in counts) if(counts[t]===1 && !SUITS.includes(t.slice(-1))) { discard=t; break; }
            if(!discard) discard = hand[Math.floor(game.rand()*hand.length)];
            p.discards.push(discard); p.hand = p.hand.filter(t => t!==discard);
            log(`${p.name} discards ${tileEmoji(discard)}`);
        }
        
        function nextTurn() {
            // Fake claims (10% chance pung)
            if(Math.random()<0.1) { log('Robot pungs!'); return; }
            
            game.currentPlayer = (game.currentPlayer+1)%4;
            updateDisplay();
            
            if(game.players[game.currentPlayer].isRobot) {
                setTimeout(robotTurn, 500);
                setTimeout(nextTurn, 1000);
            } else {
                log(`Your turn! (${game.players[game.currentPlayer].name}) Click to discard.`);
            }
            
            // Check win (dummy: <14 tiles + bonus)
            if(game.players[game.currentPlayer].hand.length < 14 && game.players[game.currentPlayer].bonus.length) {
                log(`${game.players[game.currentPlayer].name} WINS! (5+ tai)`);
                game.gameOver = true;
            }
        }
        
        function autoPlay() {
            if(game.currentPlayer===0) {
                let tile = game.players[0].hand[Math.floor(game.rand()*game.players[0].hand.length)];
                selectTile(tile, 0);
            }
        }
        
        function log(msg) {
            document.getElementById('log').innerHTML += `<div>${msg}</div>`;
            document.getElementById('log').scrollTop = 9999;
        }
        
        newGame(); // Start first game
    </script>
</body>
</html>
